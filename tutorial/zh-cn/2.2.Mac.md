### Mac

#### Docker 安装

如果你的设备上已经安装过 Docker Desktop，请确保其版本号 ≥ **20.10.10**。

> 潮汐平台的 agent 运行环境要求：
>
> Decker Desktop 版本 ≥ 20.10.10

进入 Docker 官方网站的下载页面 [https://docs.docker.com/get-docker/](https://docs.docker.com/get-docker/) ，并找到符合自己电脑操作系统的 Docker 进行下载并安装。

安装完毕后启动 Docker，Docker 界面左下角docker引擎标识呈绿色则成功启动。
![image.png](https://levimg.s3.cn-northwest-1.amazonaws.com.cn/x/87fe783c-f999-4b50-85f9-99a0080d6561.png)

#### 上传 SSH 公钥

潮汐社区的用户，需要将自己的 SSH 公钥上传到潮汐平台，以进行用户身份的认证。

如果你已经有 SSH 公钥，可以使用以下命令获取公钥信息：

> Mac/Linux：
>
> ```bash
> cd ~/.ssh
> ls -la
> cat ~/.ssh/[pubkey file].pub
> ```

如果你还没有自己的公钥，可以使用以下命令生成：

> Mac/Linux:
>
> ```bash
> $ ssh-keygen -t ed25519 -C "youremail@example.com"
> ```
>
> Windows：
>
> ```powershell
> $ ssh-keygen.exe -t ed25519
> ```
>
> 备注：不建议使用默认的 rsa 加密算法生成密钥对，ed25519 安全性更高，被新版本 OpenSSL 所支持,且 openssh8.8版本之后会默认禁用 rsa

登录潮汐平台，在 `账户设置` — `公钥管理` 中，点击 `创建 SSH 公钥` ，将公钥文件内容复制提交即可。

#### 配置ssh config文件

`touch ~/.ssh/config` 写入以下配置：

```bash
Host lev
    HostName service.lev.zone
    Port 2222
    User username # 这里将username换成你在潮汐平台的用户名
```

然后输入`ssh lev`命令，验证是否配置成功：

```Bash
$ ssh lev
Connection to service.lev.zone closed. # 显示此消息即配置成功
```

如返回以下消息，则说明配置文件有问题，请检查前述配置步骤：

```Bash
$ ssh lev
Permission denied (publickey). # 显示此消息说明ssh公钥配置有误，请检查ssh公钥和用户名是否正确
```

如果上述流程显示错误，也可以直接输入下列命令行：

```bash
ssh username@service.lev.zone -p 2222
# （username替换成潮汐平台用户名，非邮箱账号！）
```

#### 启动

在 `账户头像` - `账户设置` - `我的设备` 页面，选择 `添加设备`，随意输入一个名称，点击提交即可。

接下来，执行以下命令启动本地环境：

```bash
ssh lev agent | docker run -v /var/run/docker.sock:/docker --rm -i talentsec/lev
```

该命令将自动拉取镜像、启动容器，整个过程可能持续几分钟的时间。

> 如果由于网络原因，下载容器的速度过慢，那么可以通过更换docker镜像源的方式来进行加速。
>
> 打开docker，点击Settings进入设置，点击Docker Engine
>
> 粘贴如下代码：
> ```Bash
> "registry-mirrors": [
>   "https://mirror.baidubce.com"
> ]
> ```
>
> 点击Apply&Restart即可！
>
> 完成了上述加速操作后，再次执行以下命令启动本地环境：
>
> ```bash
> ssh lev agent | docker run -v /var/run/docker.sock:/docker --rm -i talentsec/lev
> ```

命令执行完毕后，在 `账户头像` - `账户设置` - `我的设备` 页面，可以看到该设备已经上线。

![image.png](https://levimg.s3.cn-northwest-1.amazonaws.com.cn/x/%E6%88%AA%E5%B1%8F2022-05-29+14.05.37.png)
